# Ergasia_2_E16028_Gkiontsari_Charilaos
Η Βάση δεδομένων DSMarkets περιέχει 5 collections:
* την collection Products η οποία περιέχει όλα τα προιοντα του σουπερ μαρκετ
* την collection Users η οποία περιέχει όλους του χρήστες του συστήματος
* την collection cart η οποία περιέχει όλα τα προιόντα προς αγορά
* την collection purchased η οποία περιέχει όλες τις αγορές απο όλους του χρήστες
* τέλος η collection uuids η οποία χρησιμοποίειται για το authentication των χρηστών

## Δημιουργία χρήστη και user authentication
* γι'αυτό χρησιμοποίησα τον κώδικα της προηγούμενης εργασίας με την διαφορά πως στην βαση δεδομένων uuid προσθέτω το category του χρήστη χρησιμοποιώντας την aggregate(λογικά υπήρχε καλύτερος τρόπος, αλλά δεν υπήρχε χρόνος)

## Admin
### Προσθήκη προιόντων
Αρχικά γίνεται έλεγχος για το αν υπάρχουν όλες οι απαραίτητες πληροφορίες για το προιον(όνομα, κατηγορία κλπ) στο request
Ύστερα ελέγχει αν ο χρήστης που έχει κάνει login είναι ο admin, αυτό το κάνει ελέγχοντας το username του χρήστη, επειδή δεν βρήκα τρόπο να πάρω την κατηγορία απο τη βάση uuid, αν ο χρήστης είναι ο admin χρησιμοποιεί την insert_one για να προσθέσει το προιον ση βαση

### διαγραφή 
Ελέγχει ξανα αν ο χρήστης είναι ο admin ψάχνει το id του προιοντος και αν το βρει το διαγράφει με την delete_one

### ενημέρωση προιόντων
Για την ενημέρωση υλοποίησα 4 διαφορετικά function ένα για κάθε χαρακτηριστικό που μπορεί να επεξεργαστεί αλλάζοντας στο κάθε ένα το app.route. Για την υλοποίηση ελέγχω το αν ο χρήστης είναι ο admin, ψάχνω το προιόν με το id και όταν το βρω χρησιμοποιώ το update για να κάνω $set το ζητούμενο χαρακτηριστικό

## User
### Αναζήτηση προιοντων
Η αναζήτηση έχει την ίδια λογική με την ενημέρωση, 3 διαφορετικά functions, αρχικά ελέγχει αν έχει γίνει login απο κάποιον χρήστη, ύστερα χρησιμοποιεί το ζητούμενο χαρακτηριστικό του product και την find() για να βρει το προιόν, αν δεν υπάρχει εμφανίζει σχετικό μύνημα  

### Προσθήκη στο καλάθι
Ο χρήστης δίνει στο request το id του προιοντος που θέλει να προσθέσει, τα στοιχεια του product προστίθενται σε ένα list το οποίο προστίθεται στην collection cart η οποία αδειάζει κάθε φορα που το πρόγραμμα τρέχει

### Εμφάνιση καλαθιού
Χρησιμοποιώ ξανά την aggregate για να βγάλω το sum του κόστους του cart, ύστερα προσθέτω το κόστος στο cart. Όποτε τρέχει η getCart γίνεται set ως true η hasrun την οποία χρησιμοποιώ για την αγορά του cart

### Αγορά του cart
Για την αγορά ο χρήστης θα πρέπει να έχει τρέξει την getCart αυτό το ελέγχω βλέποντας αν η hasRun είναι true, αν την έχει τρέξει το πρόγραμμα δέχεται τον 16ψηφιο κωδικό της πιστωτικής, τέλος προσθέτει τον κωδικό της πιστωτικής στην users και όλα τα στοιχεία της αγοράς στην collection purchased

### Εμφάνιση ιστορικού
Η εμφάνιση του ιστορικού ήταν ο λόγος δημιουργίας της collection purchased, εκεί ο χρήστης απλά εισάγει το email του και κάνει αναζήτηση στην purchased με βάση αυτό.

### διαγραφή product απο το cart
Κάνει αναζήτηση με το id στο cart και αν βρει το προιον, χρησιμοποιεί την delete_one για να το σβήσει, αν δεν βρεθεί επιστρέφει σχετικό μηνυμα.

### διαγραφή user
Χρησιμοποιεί την ίδια λογική με το προηγούμενο ερώτημα. Κάνει αναζήτηση για τον χρήστη και τον σβήνει με την delete_one, σε περίπτωση που δεν βρεθεί εμφανίζει σχετικό μήνυμα.
